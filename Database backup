--
-- PostgreSQL database dump
--

-- Dumped from database version 13.1
-- Dumped by pg_dump version 13.1

-- Started on 2020-12-21 17:12:02

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 219 (class 1255 OID 32806)
-- Name: SommaNprenotazioni(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public."SommaNprenotazioni"() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
BEGIN
UPDATE Tratta
SET  Tratta.Nprenotazioni = 
Tratta.Nprenotazioni + 1
WHERE NEW.CodTratta
LIKE Tratta.CodTratta;  
RETURN NULL; END;
$$;


ALTER FUNCTION public."SommaNprenotazioni"() OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 204 (class 1259 OID 16616)
-- Name: Biglietto; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Biglietto" (
    "CodFiscale" character varying(16) NOT NULL,
    "Tipo di biglietto" character varying(40) NOT NULL,
    "CodBiglietto" character varying(6) NOT NULL,
    "CodTratta" character varying(10) NOT NULL,
    "Posto" character varying(3) NOT NULL
);


ALTER TABLE public."Biglietto" OWNER TO postgres;

--
-- TOC entry 205 (class 1259 OID 16624)
-- Name: Cliente; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Cliente" (
    "CodFiscale" character varying(16) NOT NULL,
    "Nome" text NOT NULL,
    "Cognome" text NOT NULL,
    "E-mail" text NOT NULL
);


ALTER TABLE public."Cliente" OWNER TO postgres;

--
-- TOC entry 200 (class 1259 OID 16577)
-- Name: Coda di imbarco; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Coda di imbarco" (
    "CodCoda" integer NOT NULL,
    "Tipo di coda" character varying(40) NOT NULL,
    "Ngate" integer,
    "CodSlot" integer NOT NULL
);


ALTER TABLE public."Coda di imbarco" OWNER TO postgres;

--
-- TOC entry 202 (class 1259 OID 16605)
-- Name: Compagnia; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Compagnia" (
    "CodIATA" character varying(2) NOT NULL,
    "Nome compagnia" text NOT NULL,
    "Sito web" text
);


ALTER TABLE public."Compagnia" OWNER TO postgres;

--
-- TOC entry 203 (class 1259 OID 16613)
-- Name: Fedeltà; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Fedeltà" (
    "CentoKilometri" integer,
    "CodIATA" character varying(2) NOT NULL,
    "CodFiscale " character varying(16) NOT NULL,
    "Punti" integer NOT NULL
);


ALTER TABLE public."Fedeltà" OWNER TO postgres;

--
-- TOC entry 201 (class 1259 OID 16592)
-- Name: Gate; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Gate" (
    "Ngate" integer NOT NULL,
    "CodTratta" character varying(10)
);


ALTER TABLE public."Gate" OWNER TO postgres;

--
-- TOC entry 206 (class 1259 OID 16632)
-- Name: Slot; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Slot" (
    "CodSlot" integer NOT NULL,
    "Tempo di imbarco stimato" integer NOT NULL,
    "Tempo di imbarco effettivo" integer,
    "CodCoda" integer NOT NULL,
    "Data" date NOT NULL
);


ALTER TABLE public."Slot" OWNER TO postgres;

--
-- TOC entry 207 (class 1259 OID 16647)
-- Name: Tratta; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Tratta" (
    "CodTratta" character varying(10) NOT NULL,
    "Nprenotazioni" integer NOT NULL,
    "Orario di partenza" time with time zone NOT NULL,
    "Data" date NOT NULL,
    "Ngate" integer,
    "CodIATA" character varying(2),
    "Destinazione" text NOT NULL,
    "Scali" text
);


ALTER TABLE public."Tratta" OWNER TO postgres;

--
-- TOC entry 3039 (class 0 OID 16616)
-- Dependencies: 204
-- Data for Name: Biglietto; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Biglietto" ("CodFiscale", "Tipo di biglietto", "CodBiglietto", "CodTratta", "Posto") FROM stdin;
\.


--
-- TOC entry 3040 (class 0 OID 16624)
-- Dependencies: 205
-- Data for Name: Cliente; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Cliente" ("CodFiscale", "Nome", "Cognome", "E-mail") FROM stdin;
abcd	Ciccio	Salsiccio	C.Salsiccio@gmail.com
\.


--
-- TOC entry 3035 (class 0 OID 16577)
-- Dependencies: 200
-- Data for Name: Coda di imbarco; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Coda di imbarco" ("CodCoda", "Tipo di coda", "Ngate", "CodSlot") FROM stdin;
\.


--
-- TOC entry 3037 (class 0 OID 16605)
-- Dependencies: 202
-- Data for Name: Compagnia; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Compagnia" ("CodIATA", "Nome compagnia", "Sito web") FROM stdin;
AL	Alitalia	www.Alitalia.it
\.


--
-- TOC entry 3038 (class 0 OID 16613)
-- Dependencies: 203
-- Data for Name: Fedeltà; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Fedeltà" ("CentoKilometri", "CodIATA", "CodFiscale ", "Punti") FROM stdin;
\.


--
-- TOC entry 3036 (class 0 OID 16592)
-- Dependencies: 201
-- Data for Name: Gate; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Gate" ("Ngate", "CodTratta") FROM stdin;
1	\N
\.


--
-- TOC entry 3041 (class 0 OID 16632)
-- Dependencies: 206
-- Data for Name: Slot; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Slot" ("CodSlot", "Tempo di imbarco stimato", "Tempo di imbarco effettivo", "CodCoda", "Data") FROM stdin;
\.


--
-- TOC entry 3042 (class 0 OID 16647)
-- Dependencies: 207
-- Data for Name: Tratta; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Tratta" ("CodTratta", "Nprenotazioni", "Orario di partenza", "Data", "Ngate", "CodIATA", "Destinazione", "Scali") FROM stdin;
A1	0	12:00:00+01	2021-01-01	1	AL	Milano	\N
\.


--
-- TOC entry 2888 (class 2606 OID 16623)
-- Name: Biglietto Biglietto_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Biglietto"
    ADD CONSTRAINT "Biglietto_pkey" PRIMARY KEY ("CodBiglietto");


--
-- TOC entry 2890 (class 2606 OID 16631)
-- Name: Cliente Cliente_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Cliente"
    ADD CONSTRAINT "Cliente_pkey" PRIMARY KEY ("CodFiscale");


--
-- TOC entry 2882 (class 2606 OID 16581)
-- Name: Coda di imbarco Coda di imbarco_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Coda di imbarco"
    ADD CONSTRAINT "Coda di imbarco_pkey" PRIMARY KEY ("CodCoda");


--
-- TOC entry 2886 (class 2606 OID 16612)
-- Name: Compagnia Compagnia_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Compagnia"
    ADD CONSTRAINT "Compagnia_pkey" PRIMARY KEY ("CodIATA");


--
-- TOC entry 2884 (class 2606 OID 16596)
-- Name: Gate Gate_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Gate"
    ADD CONSTRAINT "Gate_pkey" PRIMARY KEY ("Ngate");


--
-- TOC entry 2892 (class 2606 OID 16636)
-- Name: Slot Slot_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Slot"
    ADD CONSTRAINT "Slot_pkey" PRIMARY KEY ("CodSlot");


--
-- TOC entry 2894 (class 2606 OID 16654)
-- Name: Tratta Tratta_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Tratta"
    ADD CONSTRAINT "Tratta_pkey" PRIMARY KEY ("CodTratta");


--
-- TOC entry 2904 (class 2620 OID 32807)
-- Name: Biglietto Aggiornamento N° prenotazioni; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER "Aggiornamento N° prenotazioni" AFTER INSERT ON public."Biglietto" FOR EACH ROW EXECUTE FUNCTION public."SommaNprenotazioni"();


--
-- TOC entry 2900 (class 2606 OID 16680)
-- Name: Biglietto Biglietto_CodFiscale_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Biglietto"
    ADD CONSTRAINT "Biglietto_CodFiscale_fkey" FOREIGN KEY ("CodFiscale") REFERENCES public."Cliente"("CodFiscale") NOT VALID;


--
-- TOC entry 2901 (class 2606 OID 16685)
-- Name: Biglietto Biglietto_CodTratta_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Biglietto"
    ADD CONSTRAINT "Biglietto_CodTratta_fkey" FOREIGN KEY ("CodTratta") REFERENCES public."Tratta"("CodTratta") NOT VALID;


--
-- TOC entry 2896 (class 2606 OID 16642)
-- Name: Coda di imbarco Coda di imbarco_CodSlot_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Coda di imbarco"
    ADD CONSTRAINT "Coda di imbarco_CodSlot_fkey" FOREIGN KEY ("CodSlot") REFERENCES public."Slot"("CodSlot") NOT VALID;


--
-- TOC entry 2895 (class 2606 OID 16637)
-- Name: Coda di imbarco Coda di imbarco_Ngate_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Coda di imbarco"
    ADD CONSTRAINT "Coda di imbarco_Ngate_fkey" FOREIGN KEY ("Ngate") REFERENCES public."Gate"("Ngate") NOT VALID;


--
-- TOC entry 2899 (class 2606 OID 16675)
-- Name: Fedeltà Fedeltà_CodFiscale _fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Fedeltà"
    ADD CONSTRAINT "Fedeltà_CodFiscale _fkey" FOREIGN KEY ("CodFiscale ") REFERENCES public."Cliente"("CodFiscale") NOT VALID;


--
-- TOC entry 2898 (class 2606 OID 16670)
-- Name: Fedeltà Fedeltà_CodIATA_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Fedeltà"
    ADD CONSTRAINT "Fedeltà_CodIATA_fkey" FOREIGN KEY ("CodIATA") REFERENCES public."Compagnia"("CodIATA") NOT VALID;


--
-- TOC entry 2897 (class 2606 OID 16655)
-- Name: Gate Gate_CodTratta_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Gate"
    ADD CONSTRAINT "Gate_CodTratta_fkey" FOREIGN KEY ("CodTratta") REFERENCES public."Tratta"("CodTratta") NOT VALID;


--
-- TOC entry 2902 (class 2606 OID 16660)
-- Name: Tratta Tratta_CodIATA_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Tratta"
    ADD CONSTRAINT "Tratta_CodIATA_fkey" FOREIGN KEY ("CodIATA") REFERENCES public."Compagnia"("CodIATA") NOT VALID;


--
-- TOC entry 2903 (class 2606 OID 16665)
-- Name: Tratta Tratta_Ngate_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Tratta"
    ADD CONSTRAINT "Tratta_Ngate_fkey" FOREIGN KEY ("Ngate") REFERENCES public."Gate"("Ngate") NOT VALID;


-- Completed on 2020-12-21 17:12:02

--
-- PostgreSQL database dump complete
--

